---
layout: post
title:  "Firebase - Remote Config"
date:   2019-08-13 15:53:20 +0900
categories: Firebase
background: '/img/bg-post.jpg'
---

프로젝트 진행 중 앱스토어 심사에서 문제 발생 회원가입 / 로그인이  
Nice 본인인증만으로 동작하기 때문에  
한국 통신사를 사용하는 사람만 회원가입 / 로그인이 가능한데(한국에서만 서비스하는 앱)  
리뷰어의 경우 로그인이 불가능 하기 때문에 데모 계정이 필요하다는 사유로 리젝되는 상황

처음에 수정한 방식은

Locale.current.region 값이 "KR"이 아니고
오늘 날짜가 특정 날짜 이전인 경우에
Native로 만든 리뷰어용 로그인 화면을 띄우고
해당 화면에서 입력된 ID, Password를 로컬에서 비교
리뷰어용 정보인 경우
테스트 유저 정보의 key 값으로 로그인 시도 하도록 구현

...했으나

위 방법의 경우 아래와 같은 문제 점이 있어 좋은 방법이 아닌 상태

1. 일반 사용자의 경우에도 지역설정을 변경하는 경우 리뷰어용 로그인 화면에 진입이 가능
2. 앱스토어 심사 기간이 정확하지 않기 때문에 제한 설정한 날짜 이내에 심사 통과가 안되는 경우 리뷰어의 로그인이 불가능
3. 로컬에서 ID, Password를 비교하기 때문에 보안상 위험
4. 3번과 같은 원인, 로컬에서 테스트 유저 정보의 key를 전송하기 때문에 위험

몇가지 이슈가 더 있을듯 하지만
상기 사유만으로도 이미 문제는 크기 때문에 추가 설명은 패스

여러가지 방법을 찾아 봤지만 상기된 문제를 모두 회피 할 방법을 찾기 어려웠으나

해당 프로젝트에서 MLKit, Cloud Messaging 등 여러가지 기능 구현 문제로
Firebase를 적극적으로 사용 중이였는데
Firebase 기능 중 Remote Config라는 기능이 있는 것을 알게 되어

Remote Config로 상기된 문제들을 수정하여 앱스토어 출시에 성공

Firebase Reference 문서에서는 Remote Config에 대해 이렇게 설명하고 있다.

_**"앱 업데이트를 게시하지 않아도 하루 활성 사용자 수 제한 없이 무료로 앱의 동작과 모양을 변경할 수 있습니다."**_

_**"Firebase 원격 구성은 사용자가 앱 업데이트를 다운로드할 필요 없이 앱의 동작과 모양을 변경할 수 있는 클라우드 서비스입니다. 원격 구성을 사용할 때는 앱의 동작과 모양을 제어하는 인앱 기본값을 만듭니다. 그런 다음 나중에 Firebase 콘솔 또는 Remote Config REST API를 사용하여 모든 앱 사용자 또는 사용자층의 특정 세그먼트에 대한 인앱 기본값을 재정의할 수 있습니다. 업데이트를 적용할 시점을 앱에서 제어할 수 있으며, 성능에 거의 영향을 주지 않고 업데이트를 빈번하게 확인하여 적용할 수 있습니다"**_


간단하게 설명하면
Firebase 서버에 원격 구성 요소를 정의하고
앱에서는 해당 정보를 받아와서 앱에 반영하는 기능이라고 할 수 있다.

즉, 상기된 문제의 해결 법으로
Firebase 서버에 앱스토어에 출시된 버전과 심사 받으려는 버전을 비교 할 수 있는 정보와
리뷰어가 사용 할 테스트 계정의 아이디, 패스워드, 테스트 계정 키 값을 등록해두고

로그인 버튼을 클릭하는 시점에 Firebase에 등록된 정보를 갱신, 받아온 후
앱 버전이 심사 중인 버전인 경우 리뷰어용 로그인 화면을 표시,
앱스토어 출시된 버전인 경우 일반 사용자 로그인 화면을 표시

리뷰어용 로그인 화면에서 로그인 시도 할 경우
Firebase에 등록해둔 아이디, 패스워드가 입력된것인지 확인
테스트용 계정 정보와 일치하는 경우
테스트 계정 키를 Firebase 서버에서 받아와서
로그인 API를 호출하도록 수정했고 첫 심사를 통과하고
이후 진행한 업데이트 심사까지 문제없이 처리

Remote Config를 적용한 방법의 단점은

앱스토어 심사 제출시 출시 설정을 수동으로 설정해야하고
심사 통과 이후에 Firebase의 정보를 업데이트 하고
앱스토어 수동 출시를 해야하는 문제점이 있고
현재는 심사 제출시에만 심사 버전에대한 정보를 갱신하여
출시된 앱에는 영향이 없고,
자동 출시로 설정해도 문제가 없는 방법이 있을지 확인하고 있다.
